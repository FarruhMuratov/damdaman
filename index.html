<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Tour Marketplace</title>
    
    <!-- Подключение Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Подключение иконок Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Использование системного шрифта Apple, как в Telegram */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
            background-color: #ffffff;
            -webkit-tap-highlight-color: transparent; /* Убирает подсветку при тапе на iOS */
        }

        /* Кастомные стили для скроллбара и эффекта нажатия */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Анимация и ощущение клика */
        .clickable {
            transition: transform 0.1s ease-in-out, opacity 0.1s ease-in-out;
        }
        .clickable:active {
            transform: scale(0.97);
            opacity: 0.8;
        }
    </style>
</head>
<body class="text-black pb-24">

    <!-- Основной контейнер с отступами -->
    <div class="p-4 space-y-6">

        <!-- Статические блоки (верхняя часть) -->
        <div class="flex items-center space-x-1 clickable">
            <span class="text-xs font-medium">Ташкент</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>
        </div>

        <div class="flex items-center space-x-3">
            <div class="flex-grow h-10 flex items-center bg-[#efefef] rounded-xl px-3">
                <i data-lucide="search" class="text-gray-500"></i>
                <input type="text" placeholder="Искать туры и впечатления" class="bg-transparent w-full h-full ml-2 text-sm focus:outline-none placeholder-gray-500">
            </div>
            <div class="p-2 clickable">
                 <i data-lucide="heart"></i>
            </div>
        </div>

        <div class="overflow-x-auto no-scrollbar">
            <div class="flex space-x-5">
                <div class="flex flex-col items-center space-y-2 flex-shrink-0 clickable">
                    <div class="w-14 h-14 bg-[#efefef] rounded-2xl flex items-center justify-center"><i data-lucide="mountain-snow"></i></div>
                    <span class="text-xs">Горы</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-shrink-0 clickable">
                    <div class="w-14 h-14 bg-[#efefef] rounded-2xl flex items-center justify-center"><i data-lucide="palace"></i></div>
                    <span class="text-xs">История</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-shrink-0 clickable">
                    <div class="w-14 h-14 bg-[#efefef] rounded-2xl flex items-center justify-center"><i data-lucide="utensils"></i></div>
                    <span class="text-xs">Гастро</span>
                </div>
                 <div class="flex flex-col items-center space-y-2 flex-shrink-0 clickable">
                    <div class="w-14 h-14 bg-[#efefef] rounded-2xl flex items-center justify-center"><i data-lucide="bike"></i></div>
                    <span class="text-xs">Актив</span>
                </div>
            </div>
        </div>

        <!-- ДИНАМИЧЕСКИЙ БЛОК ТУРОВ -->
        <div class="space-y-4">
            <h2 class="text-xl font-bold">Все туры</h2>
            <!-- Сюда будут загружаться туры из Airtable -->
            <div id="tours-container" class="space-y-4">
                <!-- Индикатор загрузки -->
                <div id="loader" class="text-center py-10">
                    <p class="text-gray-500">Загрузка туров...</p>
                </div>
            </div>
        </div>

        <!-- Статические блоки (нижняя часть) -->
        <div class="space-y-3">
            <h2 class="text-xl font-bold">Скидки и не только</h2>
            <div class="overflow-x-auto no-scrollbar">
                <div class="flex space-x-4">
                    <div class="w-48 h-28 bg-[#efefef] rounded-2xl p-3 flex flex-col justify-between flex-shrink-0 clickable">
                        <h3 class="font-bold">Тур в подарок</h3>
                        <p class="text-xs">При бронировании двух</p>
                    </div>
                    <div class="w-48 h-28 bg-[#ffe5b4] rounded-2xl p-3 flex flex-col justify-between flex-shrink-0 clickable">
                        <h3 class="font-bold">Скидка 20%</h3>
                        <p class="text-xs">На туры в Самарканд</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Футер с навигацией -->
    <div class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-sm border-t border-gray-200 h-20 flex justify-around items-center" style="padding-bottom: env(safe-area-inset-bottom);">
        <div class="flex flex-col items-center space-y-1 text-[#007bff] clickable">
            <i data-lucide="home" class="w-6 h-6"></i>
            <span class="text-xs font-semibold">Главная</span>
        </div>
        <div class="flex flex-col items-center space-y-1 text-gray-500 clickable">
            <i data-lucide="layout-grid" class="w-6 h-6"></i>
            <span class="text-xs">Каталог</span>
        </div>
        <div class="flex flex-col items-center space-y-1 text-gray-500 clickable">
            <i data-lucide="shopping-cart" class="w-6 h-6"></i>
            <span class="text-xs">Корзина</span>
        </div>
        <div class="flex flex-col items-center space-y-1 text-gray-500 clickable">
            <i data-lucide="sparkles" class="w-6 h-6"></i>
            <span class="text-xs">ИИ-консьерж</span>
        </div>
        <div class="flex flex-col items-center space-y-1 text-gray-500 clickable">
            <i data-lucide="user-circle" class="w-6 h-6"></i>
            <span class="text-xs">Профиль</span>
        </div>
    </div>

    <script>
        // ===============================================================
        // НАСТРОЙКИ AIRTABLE: ВСТАВЬТЕ ВАШИ ДАННЫЕ СЮДА
        // ===============================================================
        const PERSONAL_ACCESS_TOKEN = 'pata76lQ3LeHvovac.fee53e322f7ad0d3aafced2f3f4067a003768bfe9e903f3f919235f5eedce609'; // Начинается с 'pat...'
        const BASE_ID = 'app7Im7rs4cSBVxso'; // Начинается с 'app...'
        const TABLE_NAME = 'Туры'; // Убедитесь, что название точное
        // ===============================================================

        // Функция для загрузки и отображения туров
        async function fetchAndRenderTours() {
            const toursContainer = document.getElementById('tours-container');
            const loader = document.getElementById('loader');
            
            // Проверка, что ключи были введены
            if (PERSONAL_ACCESS_TOKEN.startsWith('СЮДА')) {
                toursContainer.innerHTML = `<p class="text-red-500 text-center">Ошибка: Введите ваши ключи Airtable в HTML-файле.</p>`;
                return;
            }

            const url = `https://api.airtable.com/v0/${BASE_ID}/${encodeURIComponent(TABLE_NAME)}`;

            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${PERSONAL_ACCESS_TOKEN}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Ошибка Airtable: ${response.statusText}`);
                }

                const data = await response.json();
                const tours = data.records.map(record => {
                    const fields = record.fields;
                    // Проверяем, есть ли картинка, и берем URL первой
                    const imageUrl = fields['Картинка'] && fields['Картинка'][0] 
                        ? fields['Картинка'][0].url 
                        : 'https://placehold.co/600x400/efefef/999?text=Нет+фото';
                    
                    return {
                        name: fields['Название'] || 'Без названия',
                        description: fields['Описание'] || '',
                        price: fields['Цена'] || 0,
                        imageUrl: imageUrl
                    };
                });
                
                // Очищаем контейнер и убираем лоадер
                toursContainer.innerHTML = '';

                // Отрисовываем каждую карточку
                tours.forEach(tour => {
                    const tourCard = `
                        <div class="bg-white rounded-2xl overflow-hidden relative clickable border border-gray-100">
                            <img src="${tour.imageUrl}" alt="${tour.name}" class="w-full h-32 object-cover">
                            <div class="p-3">
                                <h3 class="font-semibold">${tour.name}</h3>
                                <p class="text-sm text-gray-600">${tour.description}</p>
                                <p class="text-base font-bold mt-1">${tour.price} сом</p>
                            </div>
                            <div class="absolute top-2 right-2 bg-white/70 p-1.5 rounded-full"><i data-lucide="bookmark" class="w-4 h-4"></i></div>
                        </div>
                    `;
                    toursContainer.innerHTML += tourCard;
                });

            } catch (error) {
                console.error('Не удалось загрузить туры:', error);
                toursContainer.innerHTML = `<p class="text-red-500 text-center">Не удалось загрузить туры. Проверьте консоль для деталей.</p>`;
            } finally {
                // Инициализируем иконки после добавления новых элементов
                lucide.createIcons();
            }
        }

        // Запускаем всё при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            fetchAndRenderTours();
            // Статическая инициализация иконок для элементов, которые есть сразу
            lucide.createIcons();
        });
    </script>
</body>
</html>

